# 01. 架构总览与目录规范

## 1. ComfyUI 的运行机理
ComfyUI 是一个 **Server-Client** 分离的架构：
*   **Server (Python/AIOHTTP)**: 负责解析计算图、加载模型、执行 PyTorch 运算。
*   **Client (Browser/LiteGraph.js)**: 负责 UI 渲染、节点连线、将 Workflow 序列化为 JSON 发送给服务器。

**关键流程**:
1.  用户点击 "Queue Prompt"。
2.  前端将当前图表序列化为 `api_format_json`。
3.  后端接收 JSON，根据 `execution_order` 排序。
4.  后端按顺序实例化 Python 类并执行 `FUNCTION` 指定的方法。
5.  结果通过 WebSocket 推送回前端（进度条、预览图）或保存到磁盘。

## 2. 标准插件目录结构
自 2024 年末起，官方推荐使用基于 `pyproject.toml` 的结构。

```text
custom_nodes/
└── ComfyUI_My_Plugin/          <-- 插件根目录
    ├── __init__.py             <-- [核心] 注册入口
    ├── my_node_logic.py        <-- [核心] Python 节点逻辑
    ├── pyproject.toml          <-- [最新] 依赖与元数据声明
    ├── requirements.txt        <-- [兼容] 传统依赖声明
    ├── web/                    <-- [前端] 存放 JS/CSS 文件
    │   └── my_extension.js
    └── assets/                 <-- [资源] 图标、示例工作流